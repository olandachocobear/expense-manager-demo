<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/vaadin-lumo-styles/color.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="nav-bar.html">
<link rel="import" href="info-dialog.html">
<!-- <link rel="import" href="transaction-dialog.html"> -->
<link rel="import" href="content-panel.html">
<link rel="import" href="filters-toolbar.html">
<link rel="import" href="data/store.html">
<link rel="import" href="responsive-mixin.html">
<link rel="import" href="../bower_components/iron-media-query/iron-media-query.html">

<link rel="stylesheet" type="text/css" media="print" href="./print.css" />



<dom-module id="receipt-paper">
  <template>
    <style>
        #receiptBlock{
            width: 300px;
            margin: auto;
        }
    </style>

<div id=receiptBlock >
  <div style=text-align:center>
        <center><h2>{{merchant}}</h2></center>
          <div style="display:inline;margin-top:-25px"></div>

            <h5 style=float:left;margin-top:5px;margin-bottom:-4px>MID: {{mid}}</h5>
            <h5 style=float:right;margin-top:5px;margin-bottom:-4px>TID: {{tid}}</h5>

            <!-- <dom-repeat items={{listVouchers}} mutable-data> -->
                <!-- <template> -->
                    <div value={{item}} style="margin-top:8px" on-keypress="_clearBox" on-keyup="_moveIt">
                      <center>
                          =======================================
                          <h5 style=float:left;margin-top:-1px;margin-bottom:-5px>TRACE: {{trxNo}}</h5>
                          <h5 style=float:right;margin-top:-1px;margin-bottom:-5px>DATE: {{date}}</h5>
                          <br>
                          <br>
                          <h5 style=float:left;margin-top:0px;margin-bottom:5px>BATCH: - </h5>
                          <h5 style=float:right;margin-top:0px;margin-bottom:5px>TIME: {{time}}</h5>
                          
            
                        <img src="images/voucher_burn.png" style=max-width:280px>
                        <!-- <h3 style=margin-bottom:5px>{{voucher_distinct}}</h3> -->
                        <br>
                        ------------------------------------------------------------------
                      </center>  

                      <dom-repeat items=[[voucher_distinct]]>
                          <template>
                        <h3 style=margin-bottom:5px;margin-top:10px>{{item.voucherType}}</h3>
                        ------------------------------------------------------------------      
                        <h5 style=margin-top:8px>Voucher Qty: {{item.qty}}</h5>
                        <h5 style=margin-top:-18px>Original Amount: Rp {{item.original}},-</h5>
                        <h5 style=margin-top:-18px>Discount Amount: Rp {{item.discount}},-</h5>
                        <div style=margin-top:-7px>===================================</div>
                          </template>
                      </dom-repeat>
                        
                      <H2 style=margin-bottom:23px>Remaining Amount: Rp {{remaining}},-</H2>
                    </div>
                <!-- </template> -->
            <!-- </dom-repeat> -->

            <!-- <button on-click="polymerPrint('receipt')">Print Receipt</button> -->
            
        </div>          
      </div>
      <vaadin-button theme="secondary" on-click="_print" style="opacity:0.84;height:50px;width:100%">Print</vaadin-button>
          <br><br>
    </template>
  <script>
    printDivCSS = new String ('<link href="./print.css" rel="stylesheet" type="text/css">')
    function printDiv(divId) {
        window.frames["print_frame"].document.body.innerHTML=printDivCSS + document.getElementById(divId).innerHTML
        window.frames["print_frame"].window.focus()
        window.frames["print_frame"].window.print()
    }

    function nativePrint(div){
      // this.shadowRoot.querySelector
      var divToPrint=document.getElementById(div);

      var newWin=window.open('','Print-Window');

      newWin.document.open();

      newWin.document.write('<html><body onload="window.print()">'+divToPrint.innerHTML+'</body></html>');

      newWin.document.close();

      setTimeout(function(){newWin.close();},10);
    }

    (function() {
      /**
       * @memberof ExpenseManager
       * @mixes ExpenseManager.ResponsiveMixin
       */
      class ReceiptElement extends ExpenseManager.ReduxMixin(ExpenseManager.ResponsiveMixin(Polymer.Element)) {
        static get is() {
          return 'receipt-paper';
        }
        
        static get properties() {
          return {
            trxNo: {
              type: String,
              statePath: 'lastTrx.trxNumber'
            },
            date: {
              type: String,
              value: () => {
                var tgl = new Date()  
                return `${tgl.getDate()}/${tgl.getMonth()+1}/${tgl.getFullYear()}`
              }
            },
            time: {
              type: String,
              value: () => {
                var tgl = new Date() 
                return `${tgl.getHours()}:${tgl.getMinutes()}`
              } 
            },
            voucher_distinct: {
              type: String,
              statePath: ExpenseManager.select.vouchers_group
            },
            total_discount: {
              type: String,
              statePath: ExpenseManager.select.total_discount
            },
            merchant: {
              type: Object,
              statePath: 'user.data.storeName'
            },
            mid: {
              type: Object,
              statePath: 'user.data.mid'
            },
            tid: {
              type: Object,
              statePath: 'user.data.tid'
            },
            lastTrx: {
              type: Object,
              statePath: 'lastTrx'
            },
            origAmount: {
              type: String,
              statePath: 'lastTrx.trxAmount'
            },
            remaining: {
              type: String,
              statePath: 'lastTrx.remaining'
            },
            listVouchers: {
              type: Array,
              statePath: 'lastTrx.vouchers'
            }
          };
        }
        
        _print(){
          // this.$.receiptBlock.addClass("printable");
          
          var newWin=window.open('','Print-Window');
          newWin.document.open();
          newWin.document.write('<html><body onload="window.print()">'+this.$.receiptBlock.innerHTML+'</body></html>');
          newWin.document.close();
          setTimeout(function(){newWin.close();},5);
          
        }
    }
      customElements.define(ReceiptElement.is, ReceiptElement);

      /**
       * @namespace ExpenseManager
       */
      window.ExpenseManager = window.ExpenseManager || {};
      ExpenseManager.ReceiptElement = ReceiptElement;
    })();
  </script>
</dom-module>
