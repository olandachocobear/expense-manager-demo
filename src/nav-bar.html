<link rel="import" href="../bower_components/polymer/polymer-element.html">

<link rel="import" href="../bower_components/vaadin-button/vaadin-button.html">
<link rel="import" href="../bower_components/vaadin-lumo-styles/color.html">
<link rel="import" href="../bower_components/vaadin-lumo-styles/spacing.html">
<link rel="import" href="../bower_components/vaadin-lumo-styles/typography.html">

<link rel="import" href="../bower_components/vaadin-lumo-styles/icons.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">

<!-- <link rel="import" href="../bower_components/paper-search-input/paper-search-input.html"> -->
<link rel="import" href="./spots-logo.html">
<link rel="import" href="data/store.html">

<dom-module id="nav-bar">
  <template>
    <style include="lumo-color-legacy">
      :host {
        display:grid;
        grid-template-columns: 5fr 1fr;
        grid-template-areas: "left right";

        height: 64px;
      }

      .left {
        grid-area: left;

        display: flex;
        align-items: center;
        box-sizing: border-box;
        width: 100%;
        padding: 0 var(--lumo-space-m);
      }

      .right {
        grid-area: right;

        height: 64px;
      }

      h1 {
        margin-right: auto;
        font-size: var(--lumo-font-size-xl);
      }

      vaadin-button {
        margin-left: var(--lumo-space-m);
        text-transform: uppercase;
        flex-shrink: 0;
      }
      
      #search{ 
        opacity: 0;
        transition: visibility 0.2s linear,opacity 0.15s ease-out;
        /* transition: all 400ms cubic-bezier(0.4, 0, 0.2, 1); */

      }
      #search[shown]{
       opacity: 1;
      }
      #userinfo {
        float:right;
        margin-right:2%;
      }
    </style>
    <!-- <h1></h1> -->
  <div class=left>
    <spots-logo></spots-logo>

    <a href="#/entry">
    <vaadin-button on-click="" theme$="[[entryBtnState]]">
      New Transaction
    </vaadin-button>
    </a>

    <a href="#/list">
    <vaadin-button on-click="" theme$="[[logBtnState]]">
      Redeem Log
      <!-- <iron-icon icon="lumo:edit" slot="suffix"></iron-icon> -->
      <iron-icon icon="lumo:bar-chart" slot="suffix"></iron-icon>
    </vaadin-button>
    </a>
  </div>  

  <div class=right>
    <div id=userinfo style="font-size: 12px;
        opacity: 0.8;
        margin-top:-4px;margin-right:3px;text-align:right;
        color:#4d4d4d">
          <p>
            Hi,
            <u><b><span style=color:blue>[[username]]</span></b></u>!</i>
            <br>
            
            <div style=margin-top:9px;>Not You?</div>
            <div style=margin-top:-5px>
              <a href="#" 
                onclick="_logOut()"
                target="_self">
                Logout.
              </a>
            </div>
          </p>
        </div>
  </div>
    <!-- 
    <custom-style>
      <style is="custom-style" include="demo-pages-shared-styles">
        .colors {
          --search-background-color: #233348;
          --search-text-color: #518ac0;
          --search-label-color: #b7ccd899;
          --search-width: 500px;
          --search-height:47px;
          --search-border-width: 2px;
          --search-font-size: 20px;
        }
      </style>
    </custom-style>
    <paper-search-input id=search shown$=[[showSearch]] 
      style="margin-left:24px;margin-top:2px" class="colors"
      on-paper-search-input-execute='doSearch'
      on-value-changed="checkClear"
      on-value-cleared='clearSearch'></paper-search-input> 
    -->

  </template>

  <script>
    (function() {
      /**
       * @memberof ExpenseManager
       */
      class NavBarElement extends ExpenseManager.ReduxMixin(Polymer.Element) {
        static get is() {
          return 'nav-bar';
        }
        
        static get properties() {
          return {
            username: {
              type: String,
              statePath: 'user.data.username'
            },
            logBtnState: {
              type: String
            },
            entryBtnState: {
              type: String
            },
            activePage: {
              type: String,
              statePath: 'uiState.activePage',
              observer: '_switchBtn'
            },
            showSearch: {
              type: Boolean
            }
          }
        }
        
        checkClear(e) {
          // checkin the latest condition
          if (!e.bubbles)
            if (e.detail.value=='')
              this.clearSearch();
        }
        doSearch(e) {
          console.log('searchin for voucher #'+ e.detail.value)
          this.dispatch('searchVoucher', e.detail.value)
        }
        
        clearSearch(){
          this.dispatch('searchVoucher', '');
        }
        _switchBtn(){
          if(this.activePage=='list'){
            this.logBtnState = "primary"
            this.entryBtnState = "small"
            this.showSearch =true
          }
          else {
            this.logBtnState = "small"
            this.entryBtnState = "primary"
            this.showSearch =false
          }
        }
        _showInfoDialog() {
          this.dispatch('showInfoDialog');
        }

        _logout() {
          this.dispatch('logout');
        }
      }

      customElements.define(NavBarElement.is, NavBarElement);

      /**
       * @namespace ExpenseManager
       */
      window.ExpenseManager = window.ExpenseManager || {};
      ExpenseManager.NavBarElement = NavBarElement;
    })();
  </script>
</dom-module>
