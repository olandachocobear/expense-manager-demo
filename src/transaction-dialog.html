<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/vaadin-button/vaadin-button.html">
<link rel="import" href="../bower_components/vaadin-dialog/vaadin-dialog.html">

<link rel="import" href="../bower_components/number-input/number-input.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="constant.html">

<link rel="import" href="./vouchers-area.html">

<script src="./js/transaction-dialog.js"></script>

<dom-module id="transaction-dialog">
  <template>
      <!-- <iron-ajax id="ajax"
        url="https://reqres.in/api/login" method="post" 
        handle-as="json"
        on-response="onResponse"
        on-error="onError"
        last-response="{{response}}">
      </iron-ajax> -->

      <iron-ajax id="processRedeem" 
          url={{ironUrl}} method="post" 
          body="{{bodyRequest}}"
          headers='{"Content-Type": "application/json"}'
          on-response="eligibleResponse"
          on-error="onError"
          timeout=30000>
      </iron-ajax>

    
    <vaadin-dialog style="z-index:0" modeless=false id="dialog" no-close-on-esc no-close-on-outside-click opened="[[open]]">
      <template>
          <style>
              .wrapper {
                display: flex;
                margin-top: var(--lumo-space-s);
              }
    
              #form {
                min-width: 300px;
                display: flex;
                flex-direction: column;
              }
    
              #upload {
                margin-left: var(--lumo-space-l);
              }
    
              .buttons vaadin-button {
                margin-right: var(--lumo-space-m);
              }
    
              vaadin-text-area {
                min-height: 125px;
              }
    
              img {
                max-width: 350px;
              }
    
              @media (max-width: 900px) {
                [part~="overlay"] {
                  align-self: stretch;
                  border-radius: 0;
                }
    
                #upload {
                  margin: 10px 0;
                }
    
                .wrapper {
                  flex-direction: column;
                }
    
                .receipt-wrapper img {
                  max-width: 100%;
                }
              }
              h4 {
                font-size: 10px;
                margin-bottom: -18px;
              }
              h2 {
                margin-bottom:13px;
              }
              #reset_btn { display: none}
              #reset_btn[shown] {display: block;}
              
              #remaining { display: none; }
              
              @media (max-width:500px){
                #remaining { margin-top:-62px }
              }
              @media (min-width:501px){
                #remaining { margin-top:-60px }
              }

              #remaining[shown] {display: block;}
              #remaining[disabled] {
                  color: #000 !important;
                  font-size: 20px !important;
                  font-style: oblique;
              }
          </style>

        <div style="float:right;line-height: 22px;
        font-size: 12px;
        opacity: 0.8;
        margin-top:-4px;margin-right:3px;text-align:right">
          <p>
            Hi,
            <u><b><span style=color:blue>[[username]]</span></b></u>!</i>
            <br>
            
            <div style=margin-top:9px;>Not You?</div>
            <div style=margin-top:-5px>
              <a href="#" 
                onclick="_logOut()"
                target="_self">
                Logout.
              </a>
            </div>
          </p>
        </div>

        <h3 style=font-size:1em;margin-top:3px>VOUCHER REDEMPTION</h3>
        <h2 style=margin-top:4px>[[merchantName]]</h2>
        <h3 style="margin-top: -11px; font-size:0.9em;color: rgb(0,0,0,0.6);">
          [[storeName]]
        </h3>

        <div id="form">
            <!-- <iron-a11y-keys keys="enter" on-keys-pressed="_save"></iron-a11y-keys> -->
            
            <!-- <vaadin-combo-box name="merchant" items='[{"label": "Voucher", "value": 0}, {"label": "Coupon", "value": 1}]' value="{{_expense.transType}}" selected="Voucher" label="Type Promotion" required></vaadin-combo-box> -->

            <vaadin-text-field name="total" 
              prevent-invalid-input pattern="[0-9.]*" value="{{fieldAmount}}" 
              on-change="detectChanges" label="Total transaction" 
              required apply-format
              style="--lumo-text-field-size: var(--lumo-size-l);
                    font-size: var(--lumo-font-size-xl);
                    margin-top:10px">
              <div slot="prefix">Rp</div>
            </vaadin-text-field>


            <div class="vaadin-text-field-container" style="margin-top:26px;
                  font-weight:500; 
                  font-size: var(--lumo-font-size-s); 
                  color: var(--lumo-secondary-text-color);
            ">
                <label part="label" id="vaadin-text-field-label-11">Voucher code</label>
            </div>

            <div style="margin-top:7px;
                        width: 100%;
                        text-align: center;">

            <vouchers-area add-allowed=false> </vouchers-area>
            </div>  
            
            
            <!-- <vaadin-text-area name="comment" label="Comment" value="{{_expense.comment}}"></vaadin-text-area> -->
            
            
            <vaadin-text-field readonly id="remaining" theme="align-right" 
              value="Rp [[remainingTxt]]" label="Remaining Amount" pattern="[0-9]*"
              shown$="[[displayRemaining]]">
                <div slot="prefix"></div>
            </vaadin-text-field>


            <div style="display:none;margin-top:31px;
            margin-bottom:28px; text-align:center">
              
              <vaadin-text-field value="Go-Cafe 25k!!" readonly style="
                font-size:15px;
                opacity:90%;
                width:121px;
                height:53px;
                background-color:darkseagreen"
              ></vaadin-text-field>

            </div>
          </div>
<!-- 
        <center style=margin-top:17px;margin-bottom:18px> ----- </center> -->


        <!-- disabled=[[!validTrx]]  -->
        <div class="buttons" style=text-align:center;margin-bottom:-10px>
          <vaadin-button theme$="[[redeemable]]" disabled=[[!validTrx]] on-click="_burn" style="opacity:0.84;height:50px;width:100%">Redeem!</vaadin-button>
          <vaadin-button id=reset_btn shown$="[[resetable]]" theme="tertiary" on-click="_reset"
            style="font-weight:normal;color:red;margin-left:15px"><u>Reset</u></vaadin-button>
        </div>

      </template>
    </vaadin-dialog>

  </template>
  
</dom-module>
